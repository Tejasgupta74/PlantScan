<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>PlantScan — AI Plant Intelligence</title>
  <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css" rel="stylesheet" />
  <style>
    :root{--green-600:#27ae60;--green-50:#f0fdf4;--green-100:#dcfce7;--text-900:#0f172a;--text-600:#475569;--text-400:#94a3b8;--border:#e2e8f0;--surface:#fff;--bg:#f8fafc;--radius:12px}
    *{margin:0;padding:0;box-sizing:border-box}
    body{font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,"Helvetica Neue",sans-serif;background:linear-gradient(135deg,#f8fafc 0%,#f1f5f9 100%);color:var(--text-900);line-height:1.6;-webkit-font-smoothing:antialiased;padding:20px;padding-top:100px}
    
    /* HEADER */
    .navbar{position:fixed;top:0;left:0;right:0;height:72px;background:rgba(255,255,255,0.95);backdrop-filter:blur(10px);border-bottom:1px solid var(--border);display:flex;align-items:center;justify-content:space-between;padding:0 32px;z-index:1000;box-shadow:0 4px 12px rgba(15,23,42,0.04)}
    .navbar .brand{display:flex;align-items:center;gap:10px;font-size:24px;font-weight:800;color:var(--green-600);text-decoration:none}
    .navbar .brand i{font-size:28px}
    .nav-actions{display:flex;align-items:center;gap:12px}
    .nav-actions a,.nav-actions .username{padding:8px 16px;border-radius:8px;font-weight:600;text-decoration:none;color:var(--text-900);transition:all 0.15s ease;cursor:pointer}
    .nav-actions a:hover{background:var(--green-50);color:var(--green-600)}
    .nav-actions a.primary{background:var(--green-600);color:#fff;box-shadow:0 8px 16px rgba(39,174,96,0.12)}
    .nav-actions a.primary:hover{transform:translateY(-2px);box-shadow:0 12px 24px rgba(39,174,96,0.18)}
    .nav-actions .username{font-weight:700;color:var(--text-900)}
    
    /* CONTAINER */
    .container{max-width:1200px;margin:0 auto;padding:0 20px}
    
    /* HERO */
    .hero{display:grid;grid-template-columns:1fr 1fr;gap:48px;align-items:center;margin-bottom:64px;padding:40px 0}
    h1{font-size:54px;font-weight:800;line-height:1.2;margin-bottom:16px;color:var(--text-900)}
    .description{font-size:18px;color:var(--text-600);margin-bottom:28px;line-height:1.7}
    .hero-cta{display:inline-flex;align-items:center;gap:8px;padding:14px 28px;background:linear-gradient(135deg,var(--green-600) 0%,#229954 100%);color:#fff;border:none;border-radius:10px;font-size:16px;font-weight:700;cursor:pointer;box-shadow:0 12px 32px rgba(39,174,96,0.18);transition:all 0.2s ease}
    .hero-cta:hover{transform:translateY(-4px);box-shadow:0 16px 48px rgba(39,174,96,0.24)}
    .hero-cta:active{transform:translateY(-2px)}
    
    /* UPLOAD SECTION */
    .upload-section{background:var(--surface);border-radius:16px;padding:48px;box-shadow:0 8px 24px rgba(15,23,42,0.06);margin-bottom:64px}
    h2{font-size:28px;font-weight:800;margin-bottom:32px;color:var(--text-900)}
    .upload-card{border:2px dashed var(--green-600);border-radius:16px;padding:48px;text-align:center;cursor:pointer;transition:all 0.3s ease;background:linear-gradient(135deg,var(--green-50) 0%,rgba(39,174,96,0.02) 100%)}
    .upload-card:hover{border-color:#229954;background:linear-gradient(135deg,var(--green-100) 0%,var(--green-50) 100%);transform:translateY(-2px)}
    .upload-icon{font-size:72px;color:var(--green-600);margin-bottom:16px;display:block}
    .upload-text{font-size:20px;font-weight:700;color:var(--text-900);margin-bottom:8px}
    .upload-hint{font-size:14px;color:var(--text-600)}
    #imageInput{display:none}
    #imagePreview{max-width:100%;max-height:320px;border-radius:12px;margin-top:24px;display:none;box-shadow:0 12px 30px rgba(15,23,42,0.1)}
    
    /* BUTTONS */
    button{padding:12px 24px;font-size:16px;font-weight:700;border:none;border-radius:10px;cursor:pointer;transition:all 0.2s ease}
    #analyzeButton{background:var(--green-600);color:#fff;box-shadow:0 10px 24px rgba(39,174,96,0.15);width:100%;max-width:360px;margin:32px auto 0;display:block}
    #analyzeButton:hover{background:#229954;transform:translateY(-2px);box-shadow:0 14px 32px rgba(39,174,96,0.2)}
    #downloadButton{background:#e74c3c;color:#fff;display:none;box-shadow:0 10px 24px rgba(231,76,60,0.15);width:100%;max-width:360px;margin:16px auto 0}
    #downloadButton:hover{background:#c0392b;transform:translateY(-2px);box-shadow:0 14px 32px rgba(231,76,60,0.2)}
    
    /* LOADING & RESULT */
    #loading{display:none;text-align:center;margin-top:32px;color:var(--green-600);font-weight:700}
    #result{display:none;background:var(--green-50);border:2px solid var(--green-100);border-radius:12px;padding:28px;margin-top:24px;color:var(--text-900)}
    #result h3{font-size:20px;margin-bottom:12px;color:var(--green-600)}
    #result p{color:var(--text-600);line-height:1.7;font-size:15px}
    
    /* FEATURES */
    .cards{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:24px;margin-bottom:64px}
    .card{background:var(--surface);border:1px solid var(--border);border-radius:12px;padding:32px;text-align:center;transition:all 0.3s ease;box-shadow:0 4px 12px rgba(15,23,42,0.04)}
    .card:hover{transform:translateY(-8px);box-shadow:0 12px 32px rgba(39,174,96,0.12);border-color:var(--green-100)}
    .card h3{font-size:18px;font-weight:700;margin-bottom:12px;color:var(--text-900)}
    .card p{color:var(--text-600);font-size:14px;line-height:1.6}
    .card-icon{font-size:48px;color:var(--green-600);margin-bottom:16px;display:block}
    
    /* HOW IT WORKS */
    .how-works{background:var(--surface);border-radius:16px;padding:48px;box-shadow:0 8px 24px rgba(15,23,42,0.06);margin-bottom:64px}
    .steps-grid{display:grid;grid-template-columns:repeat(auto-fit,minmax(240px,1fr));gap:28px;margin-top:32px}
    .step{position:relative;padding-left:60px}
    .step-number{position:absolute;left:0;top:0;width:48px;height:48px;background:linear-gradient(135deg,var(--green-600) 0%,#229954 100%);color:#fff;border-radius:50%;display:flex;align-items:center;justify-content:center;font-weight:800;font-size:20px}
    .step h3{font-size:16px;font-weight:700;margin-bottom:8px;color:var(--text-900)}
    .step p{color:var(--text-600);font-size:14px;line-height:1.6}
    
    /* RESPONSIVE */
    @media(max-width:768px){.navbar{padding:0 16px;height:64px}.navbar .brand{font-size:20px}.nav-actions{flex-direction:column;gap:8px;width:100%}body{padding-top:80px}.hero{grid-template-columns:1fr;gap:32px;margin-bottom:40px;padding:20px 0}h1{font-size:36px}.description{font-size:16px;margin-bottom:20px}.upload-section{padding:28px}h2{font-size:22px;margin-bottom:20px}.upload-card{padding:28px}.cards{grid-template-columns:1fr}.how-works{padding:28px}.steps-grid{grid-template-columns:1fr}}
    @media(max-width:480px){.navbar{padding:0 12px}body{padding-top:70px}h1{font-size:28px;margin-bottom:12px}.description{font-size:14px}.upload-section{padding:20px}.upload-card{padding:20px}.upload-icon{font-size:48px}h2{font-size:20px}button{font-size:14px;padding:10px 16px}}
  </style>
</head>
<body>
  <nav class="navbar">
    <a href="/" class="brand"><i class="fas fa-leaf"></i> PlantScan</a>
    <div class="nav-actions" id="navUser">
      <a href="/login">Login</a>
      <a href="/signup" class="primary">Sign Up</a>
    </div>
  </nav>

  <div class="container">
    <section class="hero">
      <div>
        <h1>Discover Your Plant's Secret with AI</h1>
        <p class="description">Upload a photo and instantly get species ID, health checks, and personalized care tips. Professional-grade plant analysis at your fingertips.</p>
        <button class="hero-cta" id="heroAnalyzeBtn"><i class="fas fa-play-circle"></i> Start Analyzing</button>
      </div>
      <div style="background:linear-gradient(135deg,var(--green-50) 0%,rgba(39,174,96,0.05) 100%);border-radius:20px;border:1px solid var(--border);min-height:400px;display:flex;align-items:center;justify-content:center;overflow:hidden">
        <div id="heroVisual" style="text-align:center;color:var(--text-400);width:100%;height:100%;display:flex;align-items:center;justify-content:center"><div style="color:var(--green-600)"><i class="fas fa-leaf" style="font-size:64px;margin-bottom:12px;display:block"></i><p style="font-size:16px;font-weight:500">Your plant preview appears here</p></div></div>
      </div>
    </section>
    
    <section class="upload-section">
      <h2>Upload & Analyze</h2>
      <form id="uploadForm" enctype="multipart/form-data">
        <div class="upload-card" id="dropArea">
          <i class="fas fa-cloud-upload-alt upload-icon"></i>
          <p class="upload-text">Drag & drop your plant image here</p>
          <p class="upload-hint">or click to browse (JPG, PNG — up to 10 MB)</p>
          <input type="file" name="image" accept="image/*" id="imageInput" />
          <img id="imagePreview" alt="Plant preview" />
        </div>
        <button type="submit" id="analyzeButton"><i class="fas fa-search"></i> Analyze Plant</button>
      </form>
      <div id="loading"><i class="fas fa-spinner fa-spin"></i> Analyzing your plant...</div>
      <div id="result"></div>
      <button id="downloadButton" style="margin:16px auto 0"><i class="fas fa-file-pdf"></i> Download PDF Report</button>
    </section>
    
    <section class="how-works">
      <h2>How It Works</h2>
      <div class="steps-grid">
        <div class="step"><div class="step-number">1</div><h3>Upload Photo</h3><p>Select a clear image of your plant from your device.</p></div>
        <div class="step"><div class="step-number">2</div><h3>AI Analysis</h3><p>Our AI instantly identifies species and health status.</p></div>
        <div class="step"><div class="step-number">3</div><h3>Get Insights</h3><p>Receive detailed care tips and recommendations.</p></div>
        <div class="step"><div class="step-number">4</div><h3>Export Report</h3><p>Download a professional PDF for your records.</p></div>
      </div>
    </section>
    
    <section>
      <h2>Why PlantScan?</h2>
      <div class="cards">
        <div class="card"><i class="fas fa-brain card-icon"></i><h3>AI-Powered</h3><p>Advanced machine learning for accurate plant identification and health assessment.</p></div>
        <div class="card"><i class="fas fa-bolt card-icon"></i><h3>Instant Results</h3><p>Get comprehensive analysis in seconds, not hours.</p></div>
        <div class="card"><i class="fas fa-lock card-icon"></i><h3>Private & Secure</h3><p>Your plant photos are never shared or stored without permission.</p></div>
        <div class="card"><i class="fas fa-file-pdf card-icon"></i><h3>Export Reports</h3><p>Download detailed PDF reports for documentation and sharing.</p></div>
        
      </div>
    </section>
  </div>

  <script>
    const imageInput = document.getElementById('imageInput');
    const imagePreview = document.getElementById('imagePreview');
    const uploadForm = document.getElementById('uploadForm');
    const resultDiv = document.getElementById('result');
    const loadingDiv = document.getElementById('loading');
    const downloadButton = document.getElementById('downloadButton');
    const dropArea = document.getElementById('dropArea');
    const heroVisual = document.getElementById('heroVisual');
    let analysisResult = '';
    let analysisImage = '';

    async function refreshNav() {
      try {
        const r = await fetch('/api/user', { credentials: 'same-origin' });
        const d = await r.json();
        const nav = document.getElementById('navUser');
        if (d.user) {
          nav.innerHTML = `<span class="username">${d.user.name}</span> <a href="#" id="logoutBtn">Logout</a>`;
          document.getElementById('logoutBtn').addEventListener('click', async (e) => {
            e.preventDefault();
            await fetch('/logout', { credentials: 'same-origin' });
            window.location.reload();
          });
        } else {
          nav.innerHTML = `<a href="/login">Login</a> <a href="/signup" class="primary">Sign Up</a>`;
        }
      } catch (err) { console.error(err); }
    }
    refreshNav();

    dropArea.addEventListener('click', () => imageInput.click());
    dropArea.addEventListener('dragover', (e) => { e.preventDefault(); dropArea.style.borderColor = '#229954'; dropArea.style.background = 'rgba(39,174,96,0.08)'; });
    dropArea.addEventListener('dragleave', () => { dropArea.style.borderColor = 'var(--green-600)'; dropArea.style.background = 'linear-gradient(135deg,var(--green-50) 0%,rgba(39,174,96,0.02) 100%)'; });
    dropArea.addEventListener('drop', (e) => {
      e.preventDefault();
      const file = e.dataTransfer.files[0];
      if (file && file.type.startsWith('image/')) {
        imageInput.files = e.dataTransfer.files;
        handleImageUpload(file);
      }
    });

    imageInput.addEventListener('change', (event) => {
      const file = event.target.files[0];
      if (file) handleImageUpload(file);
    });

    function handleImageUpload(file) {
      const reader = new FileReader();
      reader.onload = function (e) {
        imagePreview.src = e.target.result;
        imagePreview.style.display = 'block';
        const heroImg = document.createElement('img');
        heroImg.src = e.target.result;
        heroImg.style.maxWidth = '100%';
        heroImg.style.maxHeight = '380px';
        heroImg.style.borderRadius = '16px';
        heroImg.style.boxShadow = '0 20px 48px rgba(15,23,42,0.08)';
        heroVisual.innerHTML = '';
        heroVisual.appendChild(heroImg);
      };
      reader.readAsDataURL(file);
    }

    uploadForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      try {
        const u = await fetch('/api/user', { credentials: 'same-origin' });
        const ui = await u.json();
        if (!ui.user) { alert('Please login to scan plants.'); window.location.href = '/login'; return; }
      } catch (err) { alert('Please login to scan plants.'); window.location.href = '/login'; return; }
      const formData = new FormData(e.target);
      loadingDiv.style.display = 'block';
      resultDiv.style.display = 'none';
      resultDiv.innerHTML = '';
      downloadButton.style.display = 'none';
      try {
        const response = await fetch('/analyze', { method: 'POST', credentials: 'same-origin', body: formData });
        const data = await response.json();
        if (data.result) {
          analysisResult = (data.result || '').replace(/\*/g, '');
          analysisImage = data.image;
          resultDiv.innerHTML = '<h3>Analysis Result</h3><p>' + analysisResult.replace(/\n/g, '<br>') + '</p>';
          resultDiv.style.display = 'block';
          downloadButton.style.display = 'inline-block';
        } else if (data.error) { resultDiv.innerHTML = '<p style="color:#c0392b"><strong>Error:</strong> ' + data.error + '</p>'; resultDiv.style.display = 'block'; }
      } catch (error) { resultDiv.innerHTML = '<p style="color:#c0392b"><strong>Error:</strong> ' + error.message + '</p>'; resultDiv.style.display = 'block'; }
      finally { loadingDiv.style.display = 'none'; }
    });

    downloadButton.addEventListener('click', async () => {
      try {
        const u = await fetch('/api/user', { credentials: 'same-origin' });
        const ui = await u.json();
        if (!ui.user) { alert('Please login to download the report.'); window.location.href = '/login'; return; }
      } catch (err) { alert('Please login to download the report.'); window.location.href = '/login'; return; }
      const response = await fetch('/download', { method: 'POST', credentials: 'same-origin', headers: {'Content-Type': 'application/json'}, body: JSON.stringify({result: analysisResult, image: analysisImage}) });
      if (response.ok) { const blob = await response.blob(); const url = window.URL.createObjectURL(blob); const a = document.createElement('a'); a.href = url; a.download = 'Plant_Analysis_Report.pdf'; document.body.appendChild(a); a.click(); a.remove(); }
      else { alert('Failed to generate the PDF report.'); }
    });

    document.getElementById('heroAnalyzeBtn').addEventListener('click', (e) => { e.preventDefault(); document.getElementById('imageInput').scrollIntoView({behavior:'smooth',block:'center'}); });
  </script>
</body>
</html>
